#!/usr/bin/env node
const figlet = require("figlet")
const Printer = require('@darkobits/lolcatjs')
const txt = figlet.textSync("S K D") + "\n" + "孙匡东脚手架"
const result = Printer.fromString(txt)
const pro = require("commander")
const inquirer = require('inquirer');
const json2ts = require("json2ts");
// 获取用户的全路径
// const userHome = require("user-home");
const shell = require("shelljs");
// 下载git
const downLoad = require("download-git-repo");
const tempalteUrl = "direct:https://github.com/qiuJinLong/yd-vue-kernel.git"

pro.version(result, "-v,--version")
pro.option("-i,--init", "项目初始化")
pro.option("-s,--surround", "配置前端开发环境")
const bindHandler = {
    init: function () {
        inquirer.prompt([
            {
                type: "text",
                message: "请输入用户文件夹的名称",
                name: "dirname"
            },
            {
                type: "list",
                name: "js",
                massage: "请选择语言",
                choices: ["ES6", "TypeScript"]
            }
        ]).then(answers => {
            console.log(answers)
            // 文件夹名称
            const _dirname = answers.dirname
            // 获取路径
            const _pwd = shell.pwd().stdout
            const _projectPath = `${_pwd}/${_dirname}`
            // 进入用户目录中
            shell.cd(_pwd)
            // 删除之前的文件
            shell.rm("-rf", _projectPath)
            // 创建新的文件
            shell.mkdir(_dirname)
            // 项目下载到 _projectPath
            downLoad(tempalteUrl, _projectPath, {clone: true}, err => {
                if (err) {
                    console.log(chalk.red("yd-cli 启动异常"), err)
                } else {
                    // 变量过滤
                    shell.sed("-i", "yd-vue-kernel", _dirname, _projectPath + "/package.json")
                }
            })
        })
    },
    json2ts(jsonUrl) {
        // 帮助我们生成接口文档
        const jsonContent = {
            code: 1,
            info: {
                message: "请求成功",
                data: [{
                    num: 1,
                    title: "3号仓库"
                }]
            }
        }
        const result = json2ts.convert(JSON.stringify(jsonContent));
        spinner.stop()
    },
    surround() {
        inquirer.prompt([
            {
                type: "list",
                name: "brew",
                massage: "是否安装 brew",
                choices: ["Yes", "No"]
            }
        ]).then(answers => {
            console.log("answers", answers)
            if(answers.brew === "Yes") {
                // shell 执行安装命令
            }
        })
    }
}
// 前面是值，后面是参数
pro.usage("<cmd> [env]")
    .arguments("<cmd> [env]")
    .action(function (cmd, otherParams) {
        const handler = bindHandler[cmd]
        if (handler) {
            handler(otherParams)
        } else {
            console.log(cmd + " have not, please run: sun --help")
        }
    });

pro.parse(process.argv)